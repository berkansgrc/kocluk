rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    function isAuth() {
      return request.auth != null;
    }

    function isAdmin() {
      return isAuth() && request.auth.token.email == 'berkan_1225@hotmail.com';
    }

    function isOwner(userId) {
      return isAuth() && request.auth.uid == userId;
    }

    // `users` collection stores roles.
    // Admins can read/write anything.
    // Authenticated users can read role data (e.g. for future UI logic).
    match /users/{userId} {
      allow read: if isAuth();
      allow write: if isAdmin();
    }

    // `students` collection stores detailed student profiles.
    // Admins can read/write everything.
    // Students can only read and update their own document.
    match /students/{studentId} {
      allow read: if isAdmin() || isOwner(studentId);
      allow update: if isAdmin() || isOwner(studentId);
      // Only admins can create or delete student profiles.
      allow create, delete: if isAdmin();
    }

    // `subjects` collection is the course library.
    // All authenticated users can read it to populate forms.
    // Only admins can modify the library.
    match /subjects/{subjectId} {
      allow read: if isAuth();
      allow write: if isAdmin();
    }
  }
}
    