rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is an admin
    function isAdmin(request) {
      return request.auth.token.email == 'berkan_1225@hotmail.com';
    }

    // `users` collection:
    // - Anyone authenticated can read (to check roles, etc.)
    // - Only admins can create, update or delete user roles
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if isAdmin(request);
    }
    
    // `students` collection:
    // - An authenticated user can only read/update their own data
    // - Admins can read/write any student's data
    match /students/{studentId} {
      allow read: if request.auth.uid == studentId || isAdmin(request);
      allow update: if request.auth.uid == studentId || isAdmin(request);
      allow create, delete: if isAdmin(request);
    }

    // `subjects` collection:
    // - Anyone authenticated can read the library (for forms)
    // - Only admins can write to the library
    match /subjects/{subjectId} {
      allow read: if request.auth != null;
      allow write: if isAdmin(request);
    }

  }
}
